name: Test Code Review Activity

on:
  workflow_dispatch:       # æ‰‹åŠ¨è§¦å‘

jobs:
  code-review:
    runs-on: ubuntu-latest

    steps:
      # æ‹‰å–ä»“åº“
      - name: Checkout repo
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GH_TOKEN }}

      # ----- éšæœºç»™ PR è¿›è¡Œä»£ç å®¡æŸ¥ (30% æ¦‚ç‡) (å¢åŠ  Code Reviews) -----
      - name: Randomly add code review comment
        run: |
          RAND=$((RANDOM % 100))
          if [ $RAND -lt 30 ]; then
            # è·å–ç¬¬ä¸€ä¸ªæ‰“å¼€çš„ PR URL
            PR_URL=$(gh pr list --state open --repo $GITHUB_REPOSITORY --json url -q '.[0].url')
            if [ -n "$PR_URL" ]; then
              echo "Adding review comment to PR: $PR_URL"
              gh pr review $PR_URL --approve --body "Good work! Keep it up! ğŸŒ±"
            else
              echo "No open PR found to review."
            fi
          else
            echo "ä»Šå¤©ä¸è¿›è¡Œä»£ç å®¡æŸ¥"
          fi
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
